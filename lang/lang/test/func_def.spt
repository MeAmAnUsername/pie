module func_impl
language pie

fixture [[
  module test:func_def
  
  data Food = foreign java test.func_def.Food {}
  data Fruit : Food = foreign java test.func_def.Fruit {}
  data Apple : Fruit = foreign java test.func_def.Apple {}

  [[...]]
]]

test duplicate function [[
  func [[test]]() -> int = 9
  func [[test]](num: int) -> int = foreign java test.func_def.DuplicateFunc#test
]] 2 errors at #1, #2
   error like "Duplicate function"

test empty generic parameter list [[func test<>() -> int = 8]] analysis succeeds
test omitted generic parameter list [[func test() -> bool = false]] analysis succeeds

test generic param single param [[
  func test<[[T]]>(elem: [[T]]) -> [[T]] = elem
]] analysis succeeds
   resolve #2 to #1
   resolve #3 to #1
test generic param three params [[
  func test<[[A]], [[B]]>(param1: [[B]], param2: [[A]], param3: [[A]]) -> [[A]] = param2
]] analysis succeeds
   resolve #3 to #2
   resolve #4 to #1
   resolve #5 to #1
   resolve #6 to #1
test generic param with upper bound [[
  func test<F : Food>(food: F) -> F = food
]] analysis succeeds
test generic param with upper bound, used with self [[
  func test<F : Fruit>(fruit: F) -> F = test(fruit)
]] analysis fails // todo  analysis succeeds
test generic param with upper bound, used with same as upper bound [[
  func test<F : Fruit>(fruit: Fruit) -> F = test(fruit)
]] analysis fails // todo  analysis succeeds
test generic param with upper bound, used with lower than upper bound [[
  func test<F : Fruit>(apple: Apple) -> F = test(apple)
]] analysis fails // todo  analysis succeeds
test generic param with upper bound, used with lower than upper bound [[
  func test<F : Fruit>(food: Food) -> F = test([[food]])
]] analysis fails
//   todo
//   1 error at #1
//   error like "not within upper bound"


test param with wildcard type [[func test(something: [[_)]] -> bool = true]] 1 error at #1  error like "Cannot use a wildcard"
test param with wildcard type [[func test(something: [[_ : Food)]] -> int = 9]] 1 error at #1  error like "Cannot use a wildcard"
test param with wildcard type [[func test(something: [[_ -: Apple<>]]) -> string = "apple"]] 1 error at #1  error like "Cannot use a wildcard"
test param with wildcard type [[
  func test(something: _[[ : Fruit<>]][[ -: Apple<>]]) -> Fruit? = null
]] 3 errors at #1, #2
   error like "Cannot use a wildcard"
   error like "Cannot have both an upper and lower bound"
